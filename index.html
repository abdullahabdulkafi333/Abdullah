<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ Ø§Ù„Ù…Ø­ØªØ±Ù | Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a2a6c; --gold: #b2945e; --dark: #0f172a; }
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; color: var(--dark); }
        
        /* Sidebar Styling */
        .sidebar { background: var(--primary); color: white; min-height: 100vh; padding: 1.5rem; box-shadow: 4px 0 10px rgba(0,0,0,0.1); }
        .nav-link { color: #cbd5e1; margin: 8px 0; border-radius: 10px; padding: 12px; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: var(--gold); color: white; transform: translateX(-5px); }
        
        /* Cards Styling */
        .card-custom { border: none; border-radius: 20px; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.4s; border-top: 4px solid var(--gold); }
        .stat-icon { font-size: 2rem; color: var(--gold); opacity: 0.3; position: absolute; left: 20px; top: 20px; }
        
        /* Table Styling */
        .table thead { background: var(--primary); color: white; }
        .table-hover tbody tr:hover { background-color: #f1f5f9; }

        /* Loader */
        #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:white; display:flex; z-index:9999; justify-content:center; align-items:center; }
    </style>
</head>
<body>

<div id="loader">
    <div class="text-center">
        <div class="spinner-grow text-primary" role="status"></div>
        <p class="mt-3 fw-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§Ø®Ø±Ø©...</p>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 sidebar d-flex flex-column">
            <h3 class="fw-800 text-center mb-5 mt-3">LOGO</h3>
            <nav class="nav flex-column">
                <a class="nav-link active" href="#" onclick="showSect('dash')">ğŸ“Š Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙˆØ§Ù„Ù…ÙŠØ²Ø§Ù†</a>
                <a class="nav-link" href="#" onclick="showSect('entry')">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙˆØ¯ ÙŠÙˆÙ…ÙŠØ©</a>
                <a class="nav-link" href="#" onclick="showSect('sales')">ğŸ’° ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a>
                <a class="nav-link" href="#" onclick="showSect('accounts')">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</a>
                <a class="nav-link" href="#" onclick="showSect('reports')">ğŸ” ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</a>
            </nav>
        </div>

        <div class="col-md-10 p-4">
            
            <div id="sect-dash" class="content-sect">
                <h2 class="mb-4 fw-bold">Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
                <div class="row mb-5">
                    <div class="col-md-12 mb-4">
                        <div class="card card-custom p-4">
                            <h5 class="fw-bold mb-3 text-primary">ğŸ“‘ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h5>
                            <div id="mizan-box" class="table-responsive"></div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card card-custom p-4">
                            <h5 class="fw-bold mb-3 text-success">ğŸ’° Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h5>
                            <div id="balance-box" class="table-responsive"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sect-entry" class="content-sect" style="display:none">
                <div class="card card-custom p-5 mx-auto" style="max-width: 700px;">
                    <h3 class="text-center mb-4">ØªØ³Ø¬ÙŠÙ„ Ù‚ÙŠØ¯ ÙŠÙˆÙ…ÙŠØ©</h3>
                    <form onsubmit="saveData(event, 'Ø§Ù„ÙŠÙˆÙ…ÙŠØ©')">
                        <input type="date" class="form-control mb-3" id="e-date" required>
                        <input type="text" class="form-control mb-3" id="e-acc" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" required>
                        <input type="number" class="form-control mb-3" id="e-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" required>
                        <button class="btn btn-primary w-100 py-2 mt-3">ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù‚ÙŠØ¯</button>
                    </form>
                </div>
            </div>

            <div id="sect-sales" class="content-sect" style="display:none">
                <div class="card card-custom p-5 mx-auto" style="max-width: 700px; border-top-color: #28a745;">
                    <h3 class="text-center mb-4 text-success">ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <form onsubmit="saveData(event, 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª')">
                        <input type="date" class="form-control mb-3" id="s-date" required>
                        <input type="text" class="form-control mb-3" id="s-client" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                        <input type="number" class="form-control mb-3" id="s-amount" placeholder="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" required>
                        <button class="btn btn-success w-100 py-2 mt-3">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                    </form>
                </div>
            </div>

            <div id="sect-accounts" class="content-sect" style="display:none">
                <div class="card card-custom p-5 mx-auto" style="max-width: 700px; border-top-color: #6f42c1;">
                    <h3 class="text-center mb-4">ÙØªØ­ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
                    <form onsubmit="saveData(event, 'Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª')">
                        <input type="text" class="form-control mb-3" id="a-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯)" required>
                        <select class="form-select mb-3" id="a-type">
                            <option value="Ø¹Ù…ÙŠÙ„">Ø¹Ù…ÙŠÙ„</option>
                            <option value="Ù…ÙˆØ±Ø¯">Ù…ÙˆØ±Ø¯</option>
                            <option value="Ù…ØµØ±ÙˆÙ">Ù…ØµØ±ÙˆÙ</option>
                        </select>
                        <button class="btn btn-dark w-100 py-2 mt-3">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    const URL = "https://script.google.com/macros/s/AKfycbydiu3gqm5iAEEWqlEt9YdRGI1oFGVz99QZ186UJ_9jc3UCO9eDU1FPdIwE_ILy6ELl/exec";

    function showSect(name) {
        document.querySelectorAll('.content-sect').forEach(s => s.style.display = 'none');
        document.getElementById('sect-' + name).style.display = 'block';
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        event.target.classList.add('active');
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³Ø±Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    async function loadData() {
        try {
            const response = await fetch(URL + "?action=getSummary");
            const data = await response.json();
            renderTable('mizan-box', data.mizan);
            renderTable('balance-box', data.balances);
            document.getElementById('loader').style.display = 'none';
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©");
        }
    }

    async function saveData(e, sheet) {
        e.preventDefault();
        const btn = e.target.querySelector('button');
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

        let values = [];
        if(sheet === 'Ø§Ù„ÙŠÙˆÙ…ÙŠØ©') values = [document.getElementById('e-date').value, document.getElementById('e-acc').value, document.getElementById('e-amount').value];
        if(sheet === 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª') values = [document.getElementById('s-date').value, document.getElementById('s-client').value, document.getElementById('s-amount').value];
        if(sheet === 'Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª') values = [document.getElementById('a-name').value, document.getElementById('a-type').value];

        await fetch(URL, {
            method: 'POST',
            body: JSON.stringify({ action: "addData", sheet: sheet, values: values })
        });

        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ ÙˆØ±Ù‚Ø© " + sheet);
        location.reload();
    }

    function renderTable(id, data) {
        let h = '<table class="table table-hover"><thead><tr>';
        data[0].forEach(cell => h += `<th>${cell}</th>`);
        h += '</tr></thead><tbody>';
        for(let i=1; i<data.length; i++){
            h += '<tr>';
            data[i].forEach(cell => h += `<td>${cell}</td>`);
            h += '</tr>';
        }
        document.getElementById(id).innerHTML = h + '</tbody></table>';
    }

    window.onload = loadData;
</script>
</body>
</html>
