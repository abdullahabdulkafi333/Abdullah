<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>معرض ال.جي</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<style>
body { font-family: Cairo, sans-serif; background:#f8fafc }
.tab { display:none }
.tab.active { display:block }
</style>
</head>

<body>

<header class="bg-blue-600 text-white p-4 flex gap-2">
<button onclick="showTab('items')" class="px-3 py-1 bg-blue-500 rounded">الأصناف</button>
<button onclick="showTab('sales')" class="px-3 py-1 bg-blue-500 rounded">المبيعات</button>
<button onclick="showTab('purchases')" class="px-3 py-1 bg-blue-500 rounded">المشتريات</button>
<button onclick="showTab('journal')" class="px-3 py-1 bg-blue-500 rounded">اليومية</button>
<button onclick="showTab('balances')" class="px-3 py-1 bg-green-600 rounded font-bold">الأرصدة</button>
</header>

<main class="p-4">

<!-- ================== تبويب الأرصدة ================== -->
<section id="balances" class="tab active">

<h2 class="text-xl font-bold mb-4">الأرصدة</h2>

<input
id="balanceSearch"
type="text"
placeholder="بحث حسب الحساب..."
class="border p-2 w-full mb-4 rounded"
onkeyup="filterBalances()"
/>

<div class="overflow-x-auto bg-white rounded shadow">
<table class="w-full border text-center text-sm">
<thead class="bg-gray-700 text-white">
<tr>
<th class="border p-2">الحساب</th>
<th class="border p-2">مبيعات $</th>
<th class="border p-2">مبيعات س</th>
<th class="border p-2">مشتريات $</th>
<th class="border p-2">مشتريات س</th>
<th class="border p-2">مدفوع $</th>
<th class="border p-2">مدفوع س</th>
<th class="border p-2">الرصيد $</th>
<th class="border p-2">الرصيد س</th>
</tr>
</thead>
<tbody id="balancesTable"></tbody>
</table>
</div>

</section>

</main>

<script>
function showTab(id){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
}
</script>

<script>
const balancesCSV =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRZgBZaf8J75UuFGvmdPbl95jnO9kfoVzKM2vULW4QhfDWEpAVp0uZ4hO4O3GgK20v2Y35UcW8nNnLW/pub?gid=1938588271&single=true&output=csv";

fetch(balancesCSV)
.then(r=>r.text())
.then(csv=>{
const rows = csv.split('\n').slice(1);
const tbody = document.getElementById('balancesTable');

rows.forEach(r=>{
const c = r.split(',');

const account = c[0] || '';
const salesUSD = c[1] || 0;
const salesSYP = c[2] || 0;
const buyUSD = c[3] || 0;
const buySYP = c[4] || 0;
const paidUSD = c[5] || 0;
const paidSYP = c[6] || 0;
const balUSD = parseFloat(c[7]) || 0;
const balSYP = parseFloat(c[8]) || 0;

if(balUSD===0 && balSYP===0) return;

const usdClass = balUSD>0 ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
const sypClass = balSYP>0 ? 'text-green-600 font-bold' : 'text-red-600 font-bold';

tbody.innerHTML += `
<tr class="border">
<td class="border p-1">${account}</td>
<td class="border p-1">${salesUSD}</td>
<td class="border p-1">${salesSYP}</td>
<td class="border p-1">${buyUSD}</td>
<td class="border p-1">${buySYP}</td>
<td class="border p-1">${paidUSD}</td>
<td class="border p-1">${paidSYP}</td>
<td class="border p-1 ${usdClass}">${balUSD.toFixed(2)}</td>
<td class="border p-1 ${sypClass}">${balSYP.toLocaleString()}</td>
</tr>`;
});
});
</script>

<script>
function filterBalances(){
const v = document.getElementById('balanceSearch').value.toLowerCase();
document.querySelectorAll('#balancesTable tr').forEach(tr=>{
tr.style.display = tr.innerText.toLowerCase().includes(v)?'':'none';
});
}
</script>

</body>
</html>
